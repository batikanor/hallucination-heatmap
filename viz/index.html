<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hallucination Heatmap</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        overflow: hidden; /* No scrolling */
        background: #000812;
        color: white;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* ========================================
         TOP ZONE: All UI Controls
         ======================================== */
      #top-zone {
        flex-shrink: 0; /* Don't compress */
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 16px 24px;
        background: linear-gradient(
          180deg,
          rgba(15, 23, 42, 0.9) 0%,
          rgba(0, 8, 18, 0.7) 100%
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 100;
      }

      /* Row 1: Header + Controls */
      .top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 24px;
      }

      /* Branding */
      .branding {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .branding img {
        height: 40px;
        width: 40px;
        border-radius: 10px;
      }
      .branding h1 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        line-height: 1.2;
      }
      .branding p {
        margin: 0;
        font-size: 0.75rem;
        color: #94a3b8;
      }

      /* Control Buttons */
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #e2e8f0;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.85rem;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
        transition: all 0.2s;
      }
      .btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
      }
      .btn .label {
        font-size: 0.65rem;
        color: #a8a29e; /* Stone-400 */
        text-transform: uppercase;
      }
      .btn.primary {
        background: rgba(245, 158, 11, 0.15); /* Amber */
        border-color: #f59e0b;
        color: #fcd34d;
      }
      .btn.danger {
        border-color: rgba(244, 63, 94, 0.5); /* Rose */
        color: #fda4af;
      }

      /* Divider */
      .divider {
        width: 1px;
        height: 32px;
        background: rgba(255, 255, 255, 0.1);
        margin: 0 8px;
      }

      /* Legend removed - gralobe's built-in legend is sufficient */

      /* Row 2: Workflow Hints (Optional, inline) */
      .workflow-hints {
        display: flex;
        gap: 24px;
        align-items: center;
        padding: 8px 0;
        font-size: 0.8rem;
        color: #64748b;
      }
      .workflow-hints span {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .workflow-hints .step-num {
        background: #334155;
        color: #e2e8f0;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: 700;
      }

      /* ========================================
         BOTTOM ZONE: Visualization
         ======================================== */
      #bottom-zone {
        flex: 1; /* Take all remaining space */
        display: flex;
        background: #000812;
        position: relative;
        overflow: hidden;
      }

      .globe-panel {
        flex: 1;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }
      .globe-panel:first-child {
        border-right: 1px solid rgba(255, 255, 255, 0.05);
      }

      .globe-canvas {
        width: 100%;
        height: 100%;
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 0 60px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .globe-label {
        position: absolute;
        top: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(15, 23, 42, 0.9);
        padding: 6px 14px;
        border-radius: 16px;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: #cbd5e1;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 8px;
        pointer-events: none;
        z-index: 10;
      }
      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }
      .dot.context {
        background: #5eead4; /* Teal-300 */
        box-shadow: 0 0 8px rgba(94, 234, 212, 0.5);
      }
      .dot.risk {
        background: #fb7185; /* Rose-400 */
        box-shadow: 0 0 8px rgba(251, 113, 133, 0.5);
      }

      /* ========================================
         MODALS (Keep as overlay - OK to cover globes)
         ======================================== */
      .modal-overlay {
        position: fixed;
        inset: 0;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(12px);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }
      .modal-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      .modal {
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        color: white;
        width: 560px;
        max-width: 95vw;
        position: relative;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);
      }
      .modal-header {
        padding: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      .modal-header h2 {
        margin: 0;
        font-size: 1.3rem;
      }
      .modal-header p {
        margin: 8px 0 0 0;
        color: #94a3b8;
        font-size: 0.9rem;
      }
      .close-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        width: 28px;
        height: 28px;
        border-radius: 6px;
        color: #94a3b8;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }
      .modal-body {
        padding: 0 24px 24px;
      }
      .modal-body.markdown-body {
        font-size: 0.8rem;
        line-height: 1.5;
        color: #94a3b8;
      }
      .modal-body.markdown-body h3 {
        font-size: 0.9rem;
        color: #e2e8f0;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 4px;
      }
      .modal-body.markdown-body p {
        margin-bottom: 0.75rem;
      }
      .modal-body.markdown-body ul {
        padding-left: 16px;
        margin: 0.5rem 0;
      }
      .modal-body.markdown-body li {
        margin-bottom: 0.4rem;
      }
      .math-block {
        background: rgba(0,0,0,0.3);
        padding: 8px 12px;
        border-radius: 6px;
        font-family: monospace;
        font-size: 0.75rem;
        text-align: center;
        margin: 0.5rem 0;
        border: 1px solid rgba(255,255,255,0.1);
        color: #22d3ee;
      }
      .step-row {
        display: flex;
        gap: 16px;
      }
      .step-badge {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        background: linear-gradient(135deg, #22d3ee, #0ea5e9);
        color: #083344;
        font-weight: 800;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .step-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .step-content label {
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        color: #64748b;
      }

      input,
      textarea {
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: white;
        border-radius: 8px;
        padding: 12px;
        font-size: 0.95rem;
        width: 100%;
      }
      input:focus,
      textarea:focus {
        border-color: #38bdf8;
        outline: none;
      }

      .input-row {
        display: flex;
        gap: 8px;
      }
      .action-btn {
        background: #38bdf8;
        color: #082f49;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-weight: 600;
        cursor: pointer;
        white-space: nowrap;
      }
      .confirm-btn {
        width: 100%;
        background: #4ade80;
        color: #052e16;
        border: none;
        border-radius: 8px;
        padding: 14px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
      }
      .links {
        font-size: 0.8rem;
        color: #64748b;
        display: flex;
        gap: 12px;
      }
      .links a {
        color: #38bdf8;
        text-decoration: none;
      }

      /* Drop Overlay */
      #drop-overlay {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.95);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
      }
      #drop-overlay.visible {
        display: flex;
      }
      #drop-overlay::after {
        content: "Drop JSON File";
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        border: 3px dashed rgba(255, 255, 255, 0.3);
        padding: 40px 60px;
        border-radius: 16px;
      }
      .toggle-btn {
        background: transparent;
        border: none;
        color: #94a3b8;
        padding: 6px 16px;
        border-radius: 16px;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .toggle-btn.active {
        background: #38bdf8;
        color: #082f49;
        box-shadow: 0 0 10px rgba(56, 189, 248, 0.3);
      }
      .toggle-btn:hover:not(.active) {
        color: white;
      }
    </style>
  </head>
  <body>
    <!-- Drop Overlay -->
    <div id="drop-overlay"></div>

    <!-- ============ TOP ZONE: All UI ============ -->
    <div id="top-zone">
      <div class="top-row">
        <!-- Branding -->
        <div class="branding">
          <img src="/logo.png" alt="Logo" />
          <div>
            <h1 id="app-title">Hallucination Heatmap</h1>
            <p id="app-subtitle">Visualizing AI Knowledge Boundaries</p>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <button id="btn-demo-gdp" class="btn">
            <span class="label">Demo</span>
            GDP
          </button>
          <button id="btn-methodology" class="btn" style="border-style: dashed">
            <span class="label">Info</span>
            Methodology
          </button>
          <button id="btn-pitch" class="btn active" style="border: 1px solid #a855f7; color: #a855f7;">
            <span class="label">Vision</span>
            The Pitch
          </button>
          <div class="divider"></div>
          <button id="btn-research" class="btn primary">BYO Research</button>
          <button id="btn-reset" class="btn danger">Reset</button>
        </div>

        <!-- Toggle Switch -->
        <div
          class="toggle-container"
          style="
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 20px;
            display: flex;
            gap: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
          "
        >
          <button id="btn-mode-mpe" class="toggle-btn active">
            MPE (Math)
          </button>
          <button id="btn-mode-grader" class="toggle-btn">AI Grader</button>
          <button id="btn-mode-consensus" class="toggle-btn">Consensus</button>
        </div>
        <!-- Legend moved to fixed position at bottom-left -->
      </div>

      <!-- Workflow Hints -->
      <div class="workflow-hints">
        <span><span class="step-num">1</span> Load demo or BYO data</span>
        <span
          ><span class="step-num">2</span> Compare: Left = Context, Right = AI
          Error</span
        >
        <span
          ><span class="step-num">3</span> Red zones = High hallucination
          confidence</span
        >
      </div>
    </div>

    <!-- ============ BOTTOM ZONE: Globes ============ -->
    <div id="bottom-zone">
      <div class="globe-panel">
        <div id="app-left" class="globe-canvas"></div>
        <div class="globe-label">
          <span class="dot context"></span> Context Analysis
        </div>
      </div>
      <div class="globe-panel">
        <div id="app-right" class="globe-canvas"></div>
        <div class="globe-label">
          <span class="dot risk"></span> Hallucination Risk
        </div>
      </div>
    </div>

    <!-- ============ MODALS ============ -->
    <!-- Reset Modal -->
    <div id="confirm-reset-overlay" class="modal-overlay">
      <div
        class="modal"
        style="width: 360px; text-align: center; padding: 32px"
      >
        <h2 style="color: #ef4444; margin: 0 0 16px 0">⚠️ Reset?</h2>
        <p style="color: #94a3b8; margin: 0 0 24px 0">
          Clear all data and return to initial state.
        </p>
        <div style="display: flex; gap: 12px; justify-content: center">
          <button
            id="btn-cancel-reset"
            style="
              background: rgba(255, 255, 255, 0.1);
              border: none;
              color: white;
              padding: 10px 20px;
              border-radius: 8px;
              cursor: pointer;
            "
          >
            Cancel
          </button>
          <button
            id="btn-confirm-reset"
            style="
              background: #ef4444;
              border: none;
              color: white;
              padding: 10px 20px;
              border-radius: 8px;
              cursor: pointer;
            "
          >
            Reset
          </button>
        </div>
      </div>
    </div>

    <!-- Research Modal -->
    <div id="research-overlay" class="modal-overlay">
      <div class="modal">
        <button class="close-btn" id="close-research">×</button>
        <div class="modal-header">
          <h2>BYO Research</h2>
          <p>Analyze any topic using your own AI.</p>
        </div>
        <div class="modal-body">
          <div class="step-row">
            <div class="step-badge">1</div>
            <div class="step-content">
              <label>Enter Topic</label>
              <div class="input-row">
                <input
                  type="text"
                  id="topic-input"
                  placeholder="e.g. 'Renewable Energy Adoption 2023'"
                />
                <button id="btn-copy-prompt" class="action-btn">
                  Copy Prompt
                </button>
              </div>
              <div class="links">
                <span
                  >The prompt asks the AI to find
                  <strong>Ground Truth</strong> values and compare itself.</span
                >
                <div style="margin-top: 8px; display: flex; gap: 8px; font-size: 0.8rem;">
                   <a href="https://chat.openai.com" target="_blank" style="color:#38bdf8;">ChatGPT</a> • 
                   <a href="https://claude.ai" target="_blank" style="color:#38bdf8;">Claude</a> • 
                   <a href="https://gemini.google.com" target="_blank" style="color:#38bdf8;">Gemini</a>
                </div>
              </div>
            </div>
          </div>
          <div class="step-row">
            <div class="step-badge">2</div>
            <div class="step-content">
              <label>Paste AI Response (JSON)</label>
              <textarea
                id="json-paste-area"
                rows="5"
                placeholder="Paste JSON here... Ensure it includes 'metadata.actual_value' or 'scores.model_grader' for comparison."
              ></textarea>
              <button id="btn-process-paste" class="confirm-btn">
                Visualize Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- About Modal (placeholder) -->
    <div id="about-overlay" class="modal-overlay"></div>

    <!-- Methodology Modal -->
    <div id="methodology-overlay" class="modal-overlay">
      <div class="modal" style="width: 600px">
        <button class="close-btn" id="close-methodology">×</button>
        <div class="modal-header">
          <h2>Hallucination Calculation</h2>
          <p>How we measure AI accuracy vs. fabrication.</p>
        </div>
        <div class="modal-body markdown-body">
        <div class="modal-body markdown-body">
          <p>We provide three ways to measure AI performance:</p>
          
          <h3>1. Statistical Error (MPE)</h3>
          <p>Strict mathematical comparison. Best for numeric data.</p>
          <div class="math-block">
            Error = | Predicted - Actual | / Actual
          </div>
          
          <h3>2. AI Grader (LLM-as-a-Judge)</h3>
          <p>We ask a different model (e.g. GPT-5 Nano) to grade the response quality.</p>
          <div class="math-block">
             Score (0-100) → Inverted Risk
          </div>

          <h3>3. Cross-Model Consensus</h3>
          <p>Wisdom of Crowds. We query GPT-4, Claude 3, and Gemini. If they disagree, risk is high.</p>
          <div class="math-block">
             High Variance = High Risk
          </div>
        </div>
      </div>
    </div>

    <!-- Pitch Modal -->
    <div id="pitch-overlay" class="modal-overlay">
      <div class="modal" style="width: 700px">
        <button class="close-btn" id="close-pitch">×</button>
        <div class="modal-header">
          <h2>Why This Matters</h2>
          <p>From "Thinking Fast" to Cognitive Cartography</p>
        </div>
        <div class="modal-body markdown-body">
          <h3>The Problem: System 1 Thinking</h3>
          <p>
            Nobel laureate Daniel Kahneman describes <strong>System 1</strong> as fast, intuitive, and error-prone. 
            LLMs are the ultimate System 1 engines: they hallucinate confidently because they prioritize plausibility over truth.
          </p>

          <h3>The Solution: Cognitive Cartography</h3>
          <p>
            We don't need better models; we need better maps. By visualizing the gap between 
            <strong>AI Confidence</strong> (System 1) and <strong>Ground Truth</strong> (System 2 verification), we create a geography of trust.
          </p>
          
          <div style="background: rgba(168, 85, 247, 0.1); border-left: 4px solid #a855f7; padding: 16px; margin: 16px 0; border-radius: 4px;">
            <strong>Future Vision:</strong> A real-time dashboard of the world's knowledge stability. 
            <br/>
            <em>"Is the AI consensus on Climate Policy stable today, or is it hallucinating?"</em>
          </div>

          <h3>Why This Approach?</h3>
          <ul>
            <li><strong>No Black Boxes:</strong> We don't fix the model; we expose its boundaries.</li>
            <li><strong>Cross-Model Consensus:</strong> If GPT-4, Claude, and Gemini agree, truth is likely.</li>
            <li><strong>Human-in-the-Loop:</strong> The heatmap directs human attention to where it's needed most.</li>
          </ul>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
